<!DOCTYPE html>
{% load staticfiles %}
<html>

<head>
    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/6.0.2/firebase-app.js"></script>

    <script src="https://www.gstatic.com/firebasejs/6.0.2/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/6.0.2/firebase-messaging.js"></script>

    <script>
    // Your web app's Firebase configuration
    var firebaseConfig = {
        apiKey: "AIzaSyBUH-4_qFvkszGWxII8HyooOJNDqbltDKo",
        authDomain: "bookalo-9e0fe.firebaseapp.com",
        databaseURL: "https://bookalo-9e0fe.firebaseio.com",
        projectId: "bookalo-9e0fe",
        storageBucket: "bookalo-9e0fe.appspot.com",
        messagingSenderId: "305041397855",
        appId: "1:305041397855:web:e1a3597e365315eb"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    </script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Bookalo</title>
    <meta property="og:image" content="{% static 'bookalo/img/icono.png' %}">
    <meta name="description" content="Tu sitio web de compra y venta de material escolar de segunda mano. En Bookalo, puedes encontrar material de todas las etapas educativas, incluyendo infantil, primaria, ESO, bachillerato y universidad!">
    <meta property="og:type" content="website">
    <link rel="icon" type="image/png" sizes="401x401" href="{% static 'bookalo/img/icono.png' %}">
    <link rel="icon" type="image/png" sizes="401x401" href="{% static 'bookalo/img/icono.png' %}">
    <link rel="icon" type="image/png" sizes="401x401" href="{% static 'bookalo/img/icono.png' %}">
    <link rel="icon" type="image/png" sizes="401x401" href="{% static 'bookalo/img/icono.png' %}">
    <link rel="icon" type="image/png" sizes="401x401" href="{% static 'bookalo/img/icono.png' %}">
    <link rel="stylesheet" href="{% static 'bookalo/bootstrap/css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'bookalo/fonts/fontawesome-all.min.css' %}">
    <link rel="stylesheet" href="{% static 'bookalo/fonts/font-awesome.min.css' %}">
    <link rel="stylesheet" href="{% static 'bookalo/fonts/ionicons.min.css' %}">
    <link rel="stylesheet" href="{% static 'bookalo/fonts/material-icons.min.css' %}">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Actor">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Alef">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Antic">
    <link rel="stylesheet" href="{% static 'bookalo/css/-Filterable-Cards-.css' %}">
    <link rel="stylesheet" href="{% static 'bookalo/css/best-carousel-slide.css' %}">
    <link rel="stylesheet" href="{% static 'bookalo/css/Bold-BS4-Animated-Back-To-Top.css' %}">
    <link rel="stylesheet" href="{% static 'bookalo/css/Bootstrap-Tags-Input-1.css' %}">
    <link rel="stylesheet" href="{% static 'bookalo/css/Bootstrap-Tags-Input.css' %}">
    <link rel="stylesheet" href="{% static 'bookalo/css/chat.css' %}">
    <link rel="stylesheet" href="{% static 'bookalo/css/Contact-Form-Clean.css' %}">
    <link rel="stylesheet" href="{% static 'bookalo/css/Contact-FormModal-Contact-Form-with-Google-Map.css' %}">
    <link rel="stylesheet" href="{% static 'bookalo/css/fileinput.css' %}">
    <link rel="stylesheet" href="{% static 'bookalo/css/filtroSideBar.css' %}">
    <link rel="stylesheet" href="{% static 'bookalo/css/Footer-Dark.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/10.0.2/css/bootstrap-slider.min.css">
    <link rel="stylesheet" href="{% static 'bookalo/css/icon-star-full.css' %}">
    <link rel="stylesheet" href="{% static 'bookalo/css/Map-Clean.css' %}">
    <link rel="stylesheet" href="{% static 'bookalo/css/MUSA_carousel-extended-1.css' %}">
    <link rel="stylesheet" href="{% static 'bookalo/css/MUSA_carousel-extended.css' %}">
    <link rel="stylesheet" href="{% static 'bookalo/css/Navigation-with-Search.css' %}">
    <link rel="stylesheet" href="{% static 'bookalo/css/News-Cards.css' %}">
    <link rel="stylesheet" href="{% static 'bookalo/css/Profile-Card-1.css' %}">
    <link rel="stylesheet" href="{% static 'bookalo/css/Profile-Card.css' %}">
    <link rel="stylesheet" href="{% static 'bookalo/css/Profile-Picture-With-Badge-1.css' %}">
    <link rel="stylesheet" href="{% static 'bookalo/css/Profile-Picture-With-Badge.css' %}">
    <link rel="stylesheet" href="{% static 'bookalo/css/select.css' %}">
    <link rel="stylesheet" href="{% static 'bookalo/css/Sidebar-Menu-1-Filtro.css' %}">
    <link rel="stylesheet" href="{% static 'bookalo/css/Sidebar-Menu-1.css' %}">
    <link rel="stylesheet" href="{% static 'bookalo/css/Sidebar-Menu.css' %}">
    <link rel="stylesheet" href="{% static 'bookalo/css/SIdebar-Responsive-2-1.css' %}">
    <link rel="stylesheet" href="{% static 'bookalo/css/SIdebar-Responsive-2.css' %}">
    <link rel="stylesheet" href="{% static 'bookalo/css/slider.css' %}">
    <link rel="stylesheet" href="{% static 'bookalo/css/Social-Icon-Circle.css' %}">
    <link rel="stylesheet" href="{% static 'bookalo/css/Social-Icons.css' %}">
    <link rel="stylesheet" href="{% static 'bookalo/css/starrating.css' %}">
    <link rel="stylesheet" href="{% static 'bookalo/css/styles.css' %}">
    <link rel="stylesheet" href="{% static 'bookalo/css/Tag-cloud.css' %}">
</head>

<body style="margin: 73px 0px 0px 0px;">
    <nav class="navbar navbar-light navbar-expand-xl d-xl-flex justify-content-xl-start navigation-clean-search fixed-top" style="background-color: #e91e63;padding: 16px;filter: blur(0px);">
        <div class="container-fluid">
            <a class="navbar-brand" style="margin: -7px 0px 0px 0px;padding: 0px;" href="/">
                <img class="img-fluid" style="width: 97px;height: 25px;" src="{% static 'bookalo/img/bookalo_logo.png' %}">
            </a>
            <button data-toggle="collapse" class="navbar-toggler" data-target="#navcol-1">
                <span class="sr-only">Toggle navigation</span><span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navcol-1">
                <ul class="nav navbar-nav">
                    <li class="nav-item" role="presentation"><a class="nav-link" style="color: #ffffff;font-size: 16px;font-weight: bold;" href="/">Comprar</a></li>
                </ul>
                {% if loggedin %}
                {% if tiene_notificaciones %}
                <button class="btn btn-secondary action-button" type="button" style="background-color: rgba(4,143,131,0);border-color: transparent;font-weight: bold;color: rgb(255,255,255);" data-toggle="modal" data-target="#modalNotif">Notificaciones</button>
                {% endif %}
                {% endif %}
                <form
                    class="form-inline mr-auto" target="_self">
                    <p></p>
                </form>
                <ul class="nav navbar-nav">
                    {% if loggedin %}
                    <li class="nav-item" role="presentation"><a class="nav-link" style="color: #ffffff;padding: 8px 15px;" href="/api/get_user_products">Mis productos</a></li>
                    <li class="nav-item" role="presentation"><a class="nav-link" style="color: #ffffff;padding: 8px 15px;" href="/create_product">Subir producto</a></li>
                    <li class="nav-item" role="presentation"><a class="nav-link" style="color: #ffffff;padding: 8px 15px;" href="" onclick="cerrarSesion()">Cerrar sesión</a></li>
                    {% endif %}
                </ul>
                {% if loggedin %}
                <a class="btn btn-light action-button" role="button" id="menu-toggle" style="background-color: rgb(194,194,194);padding: 8px 15px;" href="#menu-toggle">Tu perfil</a>
                {% else %}
                <a class="btn btn-light action-button" role="button" style="background-color: rgb(194,194,194);padding: 8px 15px;" data-toggle="modal" data-target="#modalLogin" href="#">Iniciar Sesion</a>
                {% endif %}
            </div>
        </div>
    </nav>
    <div class="modal fade" role="dialog" tabindex="-1" id="modalNotif">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Notificaciones</h4><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button></div>
                <div class="modal-body">
                    <p>{{ informacion_basica.nombre }}, tienes notificaciones pendientes de revisión</p>
                </div>
                <div class="modal-footer"><a class="btn btn-secondary" role="button" style="background-color: #e91e63;border-color:transparent;border-radius:20px" href="/api/get_user_profile">Ver notificaciones</a></div>
            </div>
        </div>
    </div>
    <div id="wrapper" class="toggled" style="color: rgb(40, 45, 50);margin: -3px 0px 0px 0px;">
        <div class="text-left d-lg-flex" id="sidebar-wrapper" style="background-color: rgb(40,45,50);margin: 0px 0px 50px -250px;">
            <div class="col" style="padding: 0px;color: rgb(40, 45, 50);">
                <div class="row" style="padding: 0px;">
                    <div class="col text-center" style="padding: 0px;"><a href="/api/get_user_profile"><img style="width: 100%;height: 160px;bottom: 20px;" src="{{ informacion_basica.imagen_perfil }}"></a></div>
                </div>
                <div class="row" style="width: 100%;margin: 25px 0px 0px 10px;">
                    <div class="col" style="padding: 0px;">
                        <h2 class="text-left" style="margin: 0px;color: rgb(255,255,255);font-family: Actor, sans-serif;">{{ informacion_basica.nombre }}</h2>
                    </div>
                </div>
                <div class="row" style="width: 100%;margin: 10px 0px 0px 0px;">
                    <div class="col" style="padding: 0px 0px 0px 10px;">
                        {% if informacion_basica.media_valoraciones == -1 %}
                        <h6 style="color: rgb(255,255,255);width: 150px;margin: px 0px 0px 0px;">Sin valoraciones</h6>
                        {% else %}
                        <div style="margin: 0px 0px 0px 0px;">
                            {% if informacion_basica.media_valoraciones == 1 %}<i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star-half-o"></i><i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star-o"></i><i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star-o"></i><i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star-o"></i><i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star-o"></i>
                            {% elif informacion_basica.media_valoraciones == 2 %}<i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star"></i><i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star-o"></i><i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star-o"></i><i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star-o"></i><i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star-o"></i>
                            {% elif informacion_basica.media_valoraciones == 3 %}<i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star"></i><i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star-half-o"></i><i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star-o"></i><i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star-o"></i><i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star-o"></i>
                            {% elif informacion_basica.media_valoraciones == 4 %}<i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star"></i><i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star"></i><i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star-o"></i><i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star-o"></i><i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star-o"></i>
                            {% elif informacion_basica.media_valoraciones == 5 %}<i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star"></i><i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star"></i><i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star-half-o"></i><i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star-o"></i><i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star-o"></i>
                            {% elif informacion_basica.media_valoraciones == 6 %}<i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star"></i><i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star"></i><i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star"></i><i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star-o"></i><i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star-o"></i>
                            {% elif informacion_basica.media_valoraciones == 7 %}<i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star"></i><i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star"></i><i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star"></i><i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star-half-o"></i><i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star-o"></i>
                            {% elif informacion_basica.media_valoraciones == 8 %}<i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star"></i><i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star"></i><i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star"></i><i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star"></i><i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star-o"></i>
                            {% elif informacion_basica.media_valoraciones == 9 %}<i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star"></i><i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star"></i><i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star"></i><i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star"></i><i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star-half-o"></i>
                            {% elif informacion_basica.media_valoraciones == 10 %}<i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star"></i><i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star"></i><i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star"></i><i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star"></i><i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star"></i>
                            {% else %}<i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star-o"></i><i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star-o"></i><i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star-o"></i><i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star-o"></i><i style="color: rgb(255,255,255);font-size: 20px;" class="fa fa-star-o"></i>{% endif %}
                        </div>
                        {% endif %}
                    </div>
                </div>
                <div class="row" style="margin: 20px 0px 0px 0px;padding: 0px;width: 100%;">
                    <div class="col" style="padding: 0px;"><a class="btn btn-outline-primary text-center d-xl-flex justify-content-xl-center align-items-xl-center" role="button" style="width: 100%;height: 40px;background-color: #e91e63;font-size: 22px;border-color: transparent;margin: 0px 0px 0px 0px;color: rgb(255,255,255);"
                            href="/api/get_chats">Mis chats</a></div>
                </div>
                <div class="row" style="margin: 0px 0px 0px 0px;padding: 0px;">
                    <div class="col" style="padding: 0px;font-size: 22px;"><button class="btn btn-secondary text-center d-xl-flex justify-content-xl-center align-items-xl-center" style="width: 100%;padding: -81px;height: 40px;background-color: #e91e63;font-size: 22px;border-color: transparent;margin: 3px 0px 0px 0px;"
                            type="button">Productos favoritos</button></div>
                </div>
                <div class="row" style="margin: 0px;width: 100%;">
                    <div class="col" style="width: 100%;padding: 0px;margin: 0px 0px 55px 0px;">
                        <div role="tablist" id="accordion-1" style="width: 100%;height: 100%;">
                            {% for p in informacion_basica.productos_favoritos %}
                            <div class="card" style="margin: 2px 0px 0px 0px;">
                                <div class="card-header" role="tab" style="background-color: rgba(233,30,99,0.6);margin: -1px -1px -1px -1px;">
                                    <h5 class="mb-0">
                                        <a data-toggle="collapse" aria-expanded="false" aria-controls="accordion-1 .item-{{ forloop.counter }}" href="div#accordion-1 .item-{{ forloop.counter }}" style="color: rgb(0,0,0);margin: 0px 0px 0px 0px;font-size: 17px;">{{ p.info_producto.nombre }}</a>
                                    </h5>
                                </div>
                                <div class="collapse item-{{ forloop.counter }} text-center" role="tabpanel" data-parent="#accordion-1">
                                    <div class="card-body">
                                        <div class="row" style="margin: -19px -20px;">
                                            <div class="col" style="padding: 0px;">
                                                <img style="width: 100%;height: 102%;" src="{{ p.info_producto.contenido_multimedia.0.contenido_url }}">
                                            </div>
                                            <div class="col text-left" style="padding: 0px;margin: 5px 0px 0px 10px;">
                                                <p style="margin: 0px 0px 0px;">{{ p.info_producto.num_likes }} likes</p>
                                                <p>
                                                    <strong>{{ p.info_producto.precio }} €</strong>
                                                </p>
                                                <a class="btn btn-secondary" style="margin: 0px 0px 15px 13px;width: 76px;font-size: 14px;padding: 3px 0px;background-color: #e91e63;border-color:transparent" role="button" href="/api/generic_product_view/?id={{ p.info_producto.pk }}">Ver más</a>
                                                <button onclick="anadirFavorito('{{ p.info_producto.pk }}')" class="btn btn-secondary" style="margin: 0px 0px 15px 13px;width: 76px;font-size: 14px;padding: 3px 0px;background-color: #e91e63;border-color:transparent" type="button">Quitar</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" role="dialog" tabindex="-1" id="modalLogin">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Iniciar sesión</h4><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button></div>
                <div class="modal-body">
                    <div class="col" style="padding: 0px;">
                        <div class="row" style="margin: 0px;">
                            <div class="col" style="padding: 0px;">
                                <p style="margin: 0px;">Para iniciar sesión, escoge una de las alternativas que se ofrecen a continuación.</p>
                            </div>
                        </div>
                        <div class="row" style="margin: 20px 0px 0px 0px;">
                            <div class="col text-center">
                                <button onclick="getLocation('facebookLogin')" class="btn btn-link btn-circle" style="border-radius: 50px;border: 1px solid black;background-color: #002649;border-color: 0px;padding: 0px;margin: 0px 15px 0px 0px;" type="button"><i class="icon ion-social-facebook" style="color:#ffffff;font-size:30px;"></i></button>
                                <button onclick="getLocation('googleLogin')" class="btn btn-link btn-circle" style="border-radius: 50px;border: 1px solid black;background-color: #db4437;border-color: transparent;padding: 0px;margin: 0px 20px 0px 0px;" type="button"><i class="icon ion-social-google" style="color:#ffffff;font-size:30px;"></i></button>
                                <button onclick="getLocation('twitterLogin')" class="btn btn-link btn-circle" style="border-radius: 50px;border: 1px solid black;background-color: #00aced;border-color: transparent;padding: 0px;" type="button"><i class="icon ion-social-twitter" style="color:#ffffff;font-size:30px;"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer"><button class="btn btn-light" data-dismiss="modal" style="background-color: #e91e63;color: rgb(255,255,255);" type="button">Cerrar</button></div>
            </div>
        </div>
    </div>
    <div class="modal fade" role="dialog" tabindex="-1" id="modalReport">
        <div class="modal-dialog" role="document">
            <form action="/api/create_report" method="post">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 id="tituloReporte" class="modal-title" style="font-family: Antic, sans-serif;font-size: 30px;">Reportar a Joseph Mancuso</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p style="font-family: Antic, sans-serif;">¡Vaya! Lamentamos tu mala experiencia en Bookalo. Para evitar que vuelva a ocurrir, por favor, indica el motivo del reporte.</p>
                    <h4 style="font-family: Antic, sans-serif;">Selecciona un motivo:</h4>
                    <div class="row d-xl-flex" style="margin: 20px 0px 0px 0px;">
                        <div class="col d-sm-flex d-lg-flex d-xl-flex justify-content-sm-center justify-content-lg-center justify-content-xl-center">
                            <select class="d-sm-flex d-lg-flex d-xl-flex" style="width: 80%;" id="causa" name="causa">
                                <option value="Verbal" selected="">Violencia verbal</option>
                                <option value="Sexual">Violencia sexual</option>
                                <option value="Otros">Otros</option>
                            </select>
                        </div>
                    </div>
                    <h4 style="font-family: Antic, sans-serif;margin: 20px 0px 0px 0px;">Incluye un comentario (opcional):</h4>
                    <textarea id="comentario" name="comentario" style="font-size: 12px;margin: 20px 0px 0px 30px;width: 85%;"></textarea>
                </div>
                <input type="hidden" id="uid" name="uid" value="">
                <div class="modal-footer">
                    <button class="btn btn-secondary" style="background-color: #e91e63;border-color:transparent" type="submit">Enviar</button>
                </div>
            </div>
            </form>
        </div>
    </div>
    <div class="row justify-content-center">
        <div class="col-xl-3" style="width: 20%;">
            <div class="row d-xl-flex" style="margin: 20px -15px 0px -15px;">
                <div class="col d-xl-flex">
                    <h2 id="tituloTab" style="font-family: Antic, sans-serif;margin: 0px 0px 0px 20px;">Mis chats de compras</h2>
                </div>
            </div>
            <div class="row d-xl-flex" style="margin: 20px -15px 0px -15px;">
                <div class="col">
                    <div>
                        <ul class="nav nav-tabs">
                            <li class="nav-item">
                                <button onclick="cambiarTitulo('Compras')" class="nav-link active" role="tab" data-toggle="tab" href="#tab-1" style="background-color: #e91e63;color: rgb(255,255,255);">Compras</button>
                            </li>
                            <li class="nav-item">
                                <button onclick="cambiarTitulo('Ventas')" class="nav-link" role="tab" data-toggle="tab" href="#tab-2" style="background-color: #7b052d;color: rgb(255,255,255);">Ventas</button>
                            </li>
                        </ul>
                        <input id="idChat" type="hidden" value="">
                        <div class="tab-content">
                            <div class="tab-pane active" role="tabpanel" id="tab-1">
                                <div class="text-center" style="height: 515px;overflow-y: auto;margin: 0px -15px 0px 0px;">
                                    {% for elemento in chat_comprador %}
                                    {% if not elemento.producto.estado_venta %}
                                    <button id="chat{{ elemento.pk }}" onclick="actualizarIdChat('{{ elemento.pk }}')" class="btn btn-secondary" style="background-color: maroon; border-color: transparent;border-radius: 15px;height: 60px;margin: 10px 0px 10px 0px;width: 90%;" type="button">
                                        <img class="border rounded-circle" style="width: 50px;height: 50px;border-color: transparent;" src="{{ elemento.producto.contenido_multimedia.0.contenido_url }}">
                                        &nbsp; &nbsp; &nbsp;{{ elemento.producto.nombre }}
                                        {% if elemento.num_pendientes > 0 %}
                                        <i style="margin: 0px 0px 0px 20px" id="chat{{ elemento.pk }}Icon" class="fa fa-envelope"></i>
                                        {% endif %}
                                    </button>
                                    {% else %}
                                    <button id="chat{{ elemento.pk }}" onclick="actualizarIdChat('{{ elemento.pk }}')" class="btn btn-secondary" style="background-color: #e91e63;border-color: transparent;border-radius: 15px;height: 60px;margin: 10px 0px 10px 0px;width: 90%;" type="button">
                                        <img class="border rounded-circle" style="width: 50px;height: 50px;border-color: transparent;" src="{{ elemento.producto.contenido_multimedia.0.contenido_url }}">
                                        &nbsp; &nbsp; &nbsp;{{ elemento.producto.nombre }}
                                        {% if elemento.num_pendientes > 0 %}
                                        <i style="margin: 0px 0px 0px 20px" id="chat{{ elemento.pk }}Icon" class="fa fa-envelope"></i>
                                        {% endif %}
                                    </button>
                                    {% endif %}
                                    {% endfor %}
                                </div>
                            </div>
                            <div class="tab-pane" role="tabpanel" id="tab-2">
                                <div class="text-center" style="height: 515px;overflow-y: auto;margin: 0px -15px 0px 0px;">
                                    {% for elemento in chat_vendedor %}
                                    {% if not elemento.producto.estado_venta %}
                                    <button id="chat{{ elemento.pk }}" onclick="actualizarIdChat('{{ elemento.pk }}')" class="btn btn-secondary" style="background-color: maroon;border-color: transparent;border-radius: 15px;height: 60px;margin: 10px 0px 10px 0px;width: 90%;" type="button">
                                        <img class="border rounded-circle" style="width: 50px;height: 50px;border-color: transparent;" src="{{ elemento.producto.contenido_multimedia.0.contenido_url }}">
                                        &nbsp; &nbsp; &nbsp;{{ elemento.producto.nombre }}
                                    </button>
                                    {% else %}
                                    <button id="chat{{ elemento.pk }}" onclick="actualizarIdChat('{{ elemento.pk }}')" class="btn btn-secondary" style="background-color: #e91e63;border-color: transparent;border-radius: 15px;height: 60px;margin: 10px 0px 10px 0px;width: 90%;" type="button">
                                        <img class="border rounded-circle" style="width: 50px;height: 50px;border-color: transparent;" src="{{ elemento.producto.contenido_multimedia.0.contenido_url }}">
                                        &nbsp; &nbsp; &nbsp;{{ elemento.producto.nombre }}
                                    </button>
                                    {% endif %}
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col" style="background-color: #ffffff;">
            <div id="ventanaChat" style="margin: 20px -15px 0px -15px;height: 570px;overflow-y: auto;">
            </div>
            <div class="row">
                <div class="col text-center" style="margin: 20px 0px 0px 0px;">
                    <input id="mensaje" type="text" style="width: 80%;border-color: #e91e63;border-radius: 20px;" placeholder="  Escribe tu mensaje" maxlength="1000">
                    <button id="buttonEnvio" onclick="enviarMensaje()" class="btn btn-link btn-circle" style="border-radius: 50px;border: 1px solid black;background-color: #e91e63;width: 30px;height: 30px;border-color: transparent;margin: -4px 0px 0px 10px;" type="button">
                        <i class="icon ion-android-send" style="color: #ffffff;font-size: 12px;margin: -50px 0px 0px 0px;"></i>
                    </button>
                </div>
            </div>
        </div>
        <div class="col-xl-3 text-right" style="width: 20%;">
            <div class="row" style="margin: 30px -15px 0px -15px;">
                <div class="col text-center d-xl-flex justify-content-xl-center"><img id="imagenOtro" class="border rounded-circle d-xl-flex" style="width: 150px;height: 150px;" src="{{ informacion_basica.imagen_perfil }}"></div>
            </div>
            <div class="row">
                <div class="col">
                    <h1 id="nombreOtro" class="text-center" style="font-family: Antic, sans-serif;font-size: 25px;margin: 15px 0px 0px 0px;">{{ informacion_basica.nombre }}</h1>
                </div>
            </div>
            <div class="row">
                <div class="col text-center" style="margin: 20px 0px 0px 0px;">
                    <h1 id="motivo" class="text-center" style="font-family: Antic, sans-serif;margin: 0px -15px 8px -15px;">quiere a</h1>
                </div>
            </div>
            <div class="row text-center" style="margin: 20px -15px 0px -15px;">
                <div class="col d-xl-flex justify-content-xl-center"><img id="producto" class="border rounded-circle d-xl-flex" style="width: 150px;height: 150px;" src="{{ informacion_basica.imagen_perfil }}"></div>
            </div>
            <div class="row text-center">
                <div class="col">
                    <h1 id="nombreProducto" class="text-center" style="font-family: Antic, sans-serif;font-size: 25px;margin: 15px 0px 0px 0px;">Bookalo</h1>
                </div>
            </div>
            <input type="hidden" id="id_producto" name="id_producto" value="">
            <div class="row" style="margin: 30px -15px 10px -15px;">
                <div id="divRating" class="col text-center d-xl-flex justify-content-xl-center"></div>
            </div>
            <div class="row" style="margin: 0px -15px 10px -15px;">
                <div id="divReport" class="col text-center d-xl-flex justify-content-xl-center"></div>
            </div>
        </div>
    </div>
    <input type="hidden" id="uidPropio" value="{{ informacion_basica.uid }}">
    <input type="hidden" id="focused" value="false">
    <div class="footer-dark" style="margin: 20px 0px 0px 0px;">
        <footer>
            <div class="container">
                <div class="row">
                    <div class="col-sm-6 col-md-3 col-xl-2 item">
                        <h3>Servicios</h3>
                        <ul>
                            <li><a href="#">Chat integrado</a></li>
                            <li><a href="#">Productos favoritos</a></li>
                            <li><a href="#">Valoración de usuarios</a></li>
                            <li><a href="/api/privacypolicy">Política de privacidad</a></li>
                        </ul>
                    </div>
                    <div class="col-sm-6 col-md-3 col-xl-4 item">
                        <h3>El proyecto</h3>
                        <p style="opacity: 0.60;font-size: 14px;">El proyecto Bookalo nace como el resultado del trabajo de nueve estudiantes de Ingeniería Informática en la Universidad de Zaragoza, en el marco de la asignatura de Proyecto Software</p>
                    </div>
                    <div class="col-md-6 item text">
                        <h3>Bookalo</h3>
                        <p>Bookalo nace como una plataforma para la compraventa de productos nuevos y de segunda mano, enfocándose en el material escolar de todas las etapas educativas. ¿Aún no eres parte de Bookalo? ¡Únete!</p>
                    </div>
                    <div class="col item social" style="margin: 30px 0px 0px 0px;"><a href="#"><i class="icon ion-social-facebook"></i></a><a href="#"><i class="icon ion-social-twitter"></i></a><a href="#"><i class="icon ion-social-snapchat"></i></a><a href="#"><i class="icon ion-social-instagram"></i></a></div>
                </div>
                <p class="copyright">Bookalo</p>
            </div>
        </footer>
    </div><a class="cd-top js-cd-top cd-top--fade-out cd-top--show" style="background-image: url(&quot;{% static 'bookalo/img/cd-top-arrow.svg' %}&quot;);background-color: #e91e63;" href="#0">Top</a>
    <script src="{% static 'bookalo/js/jquery.min.js' %}"></script>
    <script src="{% static 'bookalo/bootstrap/js/bootstrap.min.js' %}"></script>
    <script src="{% static 'bookalo/js/-Filterable-Cards-.js' %}"></script>
    <script src="{% static 'bookalo/js/Bold-BS4-Animated-Back-To-Top.js' %}"></script>
    <script src="{% static 'bookalo/js/Bootstrap-Tags-Input-1.js' %}"></script>
    <script src="{% static 'bookalo/js/Bootstrap-Tags-Input.js' %}"></script>
    <script src="{% static 'bookalo/js/Contact-FormModal-Contact-Form-with-Google-Map.js' %}"></script>
    <script src="{% static 'bookalo/js/favoritos.js' %}"></script>
    <script src="{% static 'bookalo/js/fileinput.min.js' %}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/10.0.2/bootstrap-slider.min.js"></script>
    <script src="{% static 'bookalo/js/MUSA_carousel-extended.js' %}"></script>
    <script src="{% static 'bookalo/js/piexif.js' %}"></script>
    <script src="{% static 'bookalo/js/piexif.min.js' %}"></script>
    <script src="{% static 'bookalo/js/purify.js' %}"></script>
    <script src="{% static 'bookalo/js/purify.min.js' %}"></script>
    <script src="{% static 'bookalo/js/Range-selector---slider.js' %}"></script>
    <script src="{% static 'bookalo/js/Sidebar-Menu.js' %}"></script>
    <script src="{% static 'bookalo/js/slider.js' %}"></script>
    <script src="{% static 'bookalo/js/sortable.js' %}"></script>
    <script src="{% static 'bookalo/js/sortable.min.js' %}"></script>
    <script src="{% static 'bookalo/js/starrating.js' %}"></script>
    <script>
        function getLocation(provider) {
            if (navigator.geolocation) {
                if(provider == "googleLogin"){
                    navigator.geolocation.getCurrentPosition(googleLogin);
                }else if(provider == "twitterLogin"){
                    navigator.geolocation.getCurrentPosition(twitterLogin);
                }else{
                    navigator.geolocation.getCurrentPosition(facebookLogin);
                }
            } else {
                alert("Geolocation is not supported by this browser.");
            }
        }
    </script>
    <script>
        function facebookLogin(position){
            var provider = new firebase.auth.FacebookAuthProvider();
            firebase.auth().useDeviceLanguage();
            firebase.auth().signInWithPopup(provider).then(function(result) {
                // This gives you a Facebook Access Token. You can use it to access the Facebook API.
                var token = result.credential.accessToken;
                // The signed-in user info.
                var user = result.user;
                // ...
                firebase.auth().currentUser.getIdToken(/* forceRefresh */ true).then(function(idToken) {
                    var csrftoken = '{{ csrf_token }}';
                    const messaging = firebase.messaging();
                    messaging.requestPermission().then(function() {
                        console.log('Notification permission granted.');
                        messaging.getToken().then(function(currentToken) {
                            if (currentToken) {
                                $.post("/api/login", {'csrfmiddlewaretoken': csrftoken, 'token': idToken, 'fcm_token': currentToken, 'latitud': position.coords.latitude, 'longitud': position.coords.longitude});
                                setTimeout(function(){
                                    document.location.reload(true);
                                }, 1500);
                            } else {
                                alert("No Instance ID token available");
                                // Show permission request.
                                console.log('No Instance ID token available. Request permission to generate one.');
                            }
                        }).catch(function(err) {
                            alert("An error occurred while retrieving token");
                            console.log('An error occurred while retrieving token. ', err);
                        });
                    }).catch(function(err) {
                        alert("Unable to get permission to notify");
                        console.log('Unable to get permission to notify.', err);
                    });
                }).catch(function(error) {
                    alert("Error al iniciar sesión")
                    // Handle error
                });
            }).catch(function(error) {
                // Handle Errors here.
                var errorCode = error.code;
                var errorMessage = error.message;
                // The email of the user's account used.
                var email = error.email;
                // The firebase.auth.AuthCredential type that was used.
                var credential = error.credential;
                // ...
                alert("No se pudo conectar con Facebook. Por favor, inténtelo de nuevo.")
            });
        }
    </script>
    <script>
        function googleLogin(position){
            var provider = new firebase.auth.GoogleAuthProvider();
            firebase.auth().useDeviceLanguage();
            firebase.auth().signInWithPopup(provider).then(function(result) {
                // This gives you a Google Access Token. You can use it to access the Google API.
                var token = result.credential.accessToken;
                // The signed-in user info.
                var user = result.user;
                // ...
                firebase.auth().currentUser.getIdToken(/* forceRefresh */ true).then(function(idToken) {
                    var csrftoken = '{{ csrf_token }}';
                    const messaging = firebase.messaging();
                    messaging.requestPermission().then(function() {
                        console.log('Notification permission granted.');
                        messaging.getToken().then(function(currentToken) {
                            if (currentToken) {
                                $.post("/api/login", {'csrfmiddlewaretoken': csrftoken, 'token': idToken, 'fcm_token': currentToken, 'latitud': position.coords.latitude, 'longitud': position.coords.longitude});
                                setTimeout(function(){
                                    document.location.reload(true);
                                }, 1500);
                            } else {
                                alert("No Instance ID token available");
                                // Show permission request.
                                console.log('No Instance ID token available. Request permission to generate one.');
                            }
                        }).catch(function(err) {
                            alert("An error occurred while retrieving token");
                            console.log('An error occurred while retrieving token. ', err);
                        });
                    }).catch(function(err) {
                        alert("Unable to get permission to notify");
                        console.log('Unable to get permission to notify.', err);
                    });
                }).catch(function(error) {
                    alert("Error al iniciar sesión")
                    // Handle error
                });
            	}).catch(function(error) {
                // Handle Errors here.
                var errorCode = error.code;
                var errorMessage = error.message;
                // The email of the user's account used.
                var email = error.email;
                // The firebase.auth.AuthCredential type that was used.
                var credential = error.credential;
                // ...
                alert("No se pudo conectar con Google. Por favor, inténtelo de nuevo.");
            });
        }
    </script>
    <script>
        function twitterLogin(position){
            var provider = new firebase.auth.TwitterAuthProvider();
            firebase.auth().useDeviceLanguage();
            firebase.auth().signInWithPopup(provider).then(function(result) {
                // This gives you a the Twitter OAuth 1.0 Access Token and Secret.
                // You can use these server side with your app's credentials to access the Twitter API.
                var token = result.credential.accessToken;
                var secret = result.credential.secret;
                // The signed-in user info.
                var user = result.user;
                // ...
                firebase.auth().currentUser.getIdToken(/* forceRefresh */ true).then(function(idToken) {
                    var csrftoken = '{{ csrf_token }}';
                    const messaging = firebase.messaging();
                    messaging.requestPermission().then(function() {
                        console.log('Notification permission granted.');
                        messaging.getToken().then(function(currentToken) {
                            if (currentToken) {
                                $.post("/api/login", {'csrfmiddlewaretoken': csrftoken, 'token': idToken, 'fcm_token': currentToken, 'latitud': position.coords.latitude, 'longitud': position.coords.longitude});
                                setTimeout(function(){
                                    document.location.reload(true);
                                }, 1500);
                            } else {
                                alert("No Instance ID token available");
                                // Show permission request.
                                console.log('No Instance ID token available. Request permission to generate one.');
                            }
                        }).catch(function(err) {
                            alert("An error occurred while retrieving token");
                            console.log('An error occurred while retrieving token. ', err);
                        });
                    }).catch(function(err) {
                        alert("Unable to get permission to notify");
                        console.log('Unable to get permission to notify.', err);
                    });
                }).catch(function(error) {
                    alert("Error al iniciar sesión")
                    // Handle error
                });
                }).catch(function(error) {
                // Handle Errors here.
                var errorCode = error.code;
                var errorMessage = error.message;
                // The email of the user's account used.
                var email = error.email;
                // The firebase.auth.AuthCredential type that was used.
                var credential = error.credential;
                // ...
                alert("No se pudo conectar con Twitter. Por favor, inténtelo de nuevo.");
            });
        }
    </script>
    <script>
        function cerrarSesion(){
            var csrftoken = '{{ csrf_token }}';
            $.post("/logout", {'csrfmiddlewaretoken': csrftoken});
            firebase.auth().signOut().then(function() {
                window.location = "https://bookalo.es"
            }).catch(function(error) {
                alert("Error al cerrar sesión");
            });
        }
    </script>
    <script>
        function cambiarTitulo(id){
            var titulo = document.getElementById("tituloTab").innerHTML;
            if(id == "Compras"){
                if(titulo == "Mis chats de ventas"){
                    document.getElementById("tituloTab").innerHTML = "Mis chats de compras";
                }
            } else {
                if(titulo == "Mis chats de compras"){
                    document.getElementById("tituloTab").innerHTML = "Mis chats de ventas";
                }
            }
        }
    </script>
    <script>
        function actualizarIdChat(id){
            $("#" + 'chat' + id + 'Icon').remove();
            document.getElementById("idChat").value = id;
            var csrftoken = '{{ csrf_token }}';
            $.post(
                "/api/get_messages",
                {'csrfmiddlewaretoken': csrftoken, 'id_chat': id},
                function(data) {
                    var i = 0;
                    document.getElementById("ventanaChat").innerHTML = "";
                    for(mensaje in data.mensajes){
                        if(data.mensajes[i].es_suyo){
                            var objTo = document.getElementById('ventanaChat');
                            var divtest = document.createElement("div");
                            divtest.innerHTML = '<div class="d-xl-flex talk-bubble tri-right round right-in" style="margin: 0px 0px 20px 85px;width: 85%;"> <div class="d-xl-flex talktext"> <p style="color: rgb(255,255,255);margin: 0px;">' + data.mensajes[i].texto + '<br></p> </div> </div>';
                            objTo.appendChild(divtest);
                        }else{
                            var objTo = document.getElementById('ventanaChat');
                            var divtest = document.createElement("div");
                            divtest.innerHTML = '<div class="d-xl-flex talk-bubble tri-right round left-in" style="margin: 0px 0px 20px 30px;width: 85%;background-color: #ff9cbe;"> <div class="d-xl-flex talktext"> <p style="color: rgb(0,0,0);margin: 0px;">' + data.mensajes[i].texto + '<br></p> </div> </div>';
                            objTo.appendChild(divtest);
                        }
                        i = i + 1;
                    }
                    if(document.getElementById('tituloTab').innerHTML == "Mis chats de compras"){
                        document.getElementById('motivo').innerHTML = "te vende";
                        document.getElementById('nombreOtro').innerHTML=data.vendedor.nombre;
                        document.getElementById('imagenOtro').src=data.vendedor.imagen_perfil;
                        document.getElementById('tituloReporte').innerHTML = "Reportar a " + data.vendedor.nombre;
                        document.getElementById('uid').value = data.vendedor.uid;
                    }else{
                        document.getElementById('motivo').innerHTML = "quiere";
                        document.getElementById('nombreOtro').innerHTML=data.comprador.nombre;
                        document.getElementById('imagenOtro').src=data.comprador.imagen_perfil;
                        document.getElementById('tituloReporte').innerHTML = "Reportar a " + data.comprador.nombre;
                        document.getElementById('uid').value = data.comprador.uid;
                    }
                    document.getElementById('producto').src=data.producto.contenido_multimedia[0].contenido_url;
                    document.getElementById('nombreProducto').innerHTML = data.producto.nombre;
                    if(document.getElementById('buttonReport') == null){
                        var button = document.createElement("div");
                        button.innerHTML = '<button id="buttonReport" class="btn btn-secondary action-button" type="button" style="background-color: #e91e63;border-color:transparent;border-radius:20px" data-toggle="modal" data-target="#modalReport">Reportar usuario</button>';
                        document.getElementById('divReport').appendChild(button);
                    }
                    if(document.getElementById('buttonRating') == null && document.getElementById('tituloTab').innerHTML == "Mis chats de ventas" && data.producto.estado_venta){
                        var button = document.createElement("div");
                        button.innerHTML = '<button id="buttonRating" onclick="venderProducto()" class="btn btn-secondary action-button" type="button" style="background-color: #e91e63;border-color:transparent;border-radius:20px">Producto vendido</button>';
                        document.getElementById('divRating').appendChild(button);
                    }else if(document.getElementById('tituloTab').innerHTML == "Mis chats de compras"){
                        var buttonRating = document.getElementById("buttonRating");
                        if(buttonRating != null){
                            buttonRating.parentNode.removeChild(buttonRating);
                        }
                    }
                    var objDiv = document.getElementById("ventanaChat");
                    objDiv.scrollTop = objDiv.scrollHeight;
                }
            );
        }
    </script>
    <script>
        function enviarMensaje(){
            var idChat = document.getElementById("idChat").value;
            var mensaje = document.getElementById("mensaje").value;
            if(idChat == ''){
                alert('Por favor, selecciona un chat de la izquierda antes de enviar un mensaje');
            }else if(mensaje == ''){
                alert('El mensaje está vacío. Por favor, escribe algo antes de enviarlo');
            }else{
                document.getElementById("mensaje").value = '';
                var csrftoken = '{{ csrf_token }}';
                $.post("/api/send_message", {'csrfmiddlewaretoken': csrftoken, 'mensaje': mensaje, 'id_chat': idChat});
                var objTo = document.getElementById('ventanaChat');
                var divtest = document.createElement("div");
                divtest.innerHTML = '<div class="d-xl-flex talk-bubble tri-right round right-in" style="margin: 0px 0px 20px 85px;width: 85%;"> <div class="d-xl-flex talktext"> <p style="color: rgb(255,255,255);margin: 0px;">' + mensaje + '<br></p> </div> </div>';
                objTo.appendChild(divtest);
                var objDiv = document.getElementById("ventanaChat");
                objDiv.scrollTop = objDiv.scrollHeight;
            }
        }

        $("#mensaje").keyup(function(event) {
            if (event.keyCode === 13) {
                $("#buttonEnvio").click();
            }
        });
    </script>
    <script>
        function venderProducto(){
            var id_chat = document.getElementById("idChat").value;
            var csrftoken = '{{ csrf_token }}';
            document.getElementById('chat' + id_chat).style.backgroundColor = "maroon";
            $.post("/api/sell_product", {'csrfmiddlewaretoken': csrftoken, 'id_chat': id_chat});
        }
    </script>
    <script>
        // Handle incoming messages. Called when:
        // - a message is received while the app has focus
        // - the user clicks on an app notification created by a service worker
        //   `messaging.setBackgroundMessageHandler` handler.
        const messaging = firebase.messaging();
        messaging.usePublicVapidKey('BClG38R8H1L_9nXVX49WasFY4SNBefdvq_f4X5NMdD7Y7550EFm7sa8bYnxgvX--xYCrbdsYoaDKs7GwDifRgUU');

        messaging.onMessage(function(payload) {
            console.log('Message received. ', payload);
            var chat = JSON.parse(payload.data.chat);

            if(document.getElementById("idChat").value == chat.pk){
                var objTo = document.getElementById('ventanaChat');
                var divtest = document.createElement("div");
                divtest.innerHTML = '<div class="d-xl-flex talk-bubble tri-right round left-in" style="margin: 0px 0px 20px 30px;width: 85%;background-color: #ff9cbe;"> <div class="d-xl-flex talktext"> <p style="color: rgb(0,0,0);margin: 0px;">' + payload.notification.body + '<br></p> </div> </div>';
                objTo.appendChild(divtest);
                var objDiv = document.getElementById("ventanaChat");
                objDiv.scrollTop = objDiv.scrollHeight;
            }else{
                var identifier = 'chat' + chat.pk;
                var buttonElement = document.getElementById(identifier);
                if(document.getElementById('chat' + chat.pk + 'Icon') == null){
                    buttonElement.innerHTML = buttonElement.innerHTML + '<i style="margin: 0px 0px 0px 20px" id="chat' + chat.pk + 'Icon" class="fa fa-envelope"></i>';
                }
            }
        });
    </script>
    <script>
        window.onfocus = function() {
            if(document.getElementById('focused').value == 'false'){
                document.getElementById('focused').value = 'true';
                var idChat = document.getElementById("idChat").value;
                var csrftoken = '{{ csrf_token }}';
                $.post(
                    "/api/get_messages",
                    {'csrfmiddlewaretoken': csrftoken, 'id_chat': idChat},
                    function(data) {
                        document.getElementById("ventanaChat").innerHTML = "";
                        var i = 0
                        for(mensaje in data.mensajes){
                            if(data.mensajes[i].es_suyo){
                                var objTo = document.getElementById('ventanaChat');
                                var divtest = document.createElement("div");
                                divtest.innerHTML = '<div class="d-xl-flex talk-bubble tri-right round right-in" style="margin: 0px 0px 20px 85px;width: 85%;"> <div class="d-xl-flex talktext"> <p style="color: rgb(255,255,255);margin: 0px;">' + data.mensajes[i].texto + '<br></p> </div> </div>';
                                objTo.appendChild(divtest);
                            }else{
                                var objTo = document.getElementById('ventanaChat');
                                var divtest = document.createElement("div");
                                divtest.innerHTML = '<div class="d-xl-flex talk-bubble tri-right round left-in" style="margin: 0px 0px 20px 30px;width: 85%;background-color: #ff9cbe;"> <div class="d-xl-flex talktext"> <p style="color: rgb(0,0,0);margin: 0px;">' + data.mensajes[i].texto + '<br></p> </div> </div>';
                                objTo.appendChild(divtest);
                            }
                            i = i + 1;
                        }
                        var objDiv = document.getElementById("ventanaChat");
                        objDiv.scrollTop = objDiv.scrollHeight;
                    }
                );
            }
        };

        window.onblur = function() {
            document.getElementById('focused').value = 'false';
        };
    </script>
</body>
</html>